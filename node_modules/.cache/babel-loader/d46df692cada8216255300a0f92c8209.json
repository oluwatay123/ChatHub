{"ast":null,"code":"var _jsxFileName = \"/home/cyberspacex/Downloads/Capstone-project5/src/components/Search.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useState } from 'react';\nimport { collection, query, where, getDocs, setDoc, updateDoc, serverTimestamp } from \"firebase/firestore\";\nimport { db } from '../firebase';\nimport { AuthContext } from '../context/AuthContext';\nimport { doc, getDoc } from 'firebase/firestore'; // import \"../style.scss\"\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Search = () => {\n  _s();\n\n  const [userName, setUserName] = useState('');\n  const [user, setUser] = useState(null);\n  const [error, setError] = useState(false);\n  const {\n    currentUser\n  } = useContext(AuthContext);\n\n  const handleSearch = async () => {\n    const q = query(collection(db, 'users'), where(\"displayName\", \"==\", userName));\n\n    try {\n      const querySnapshot = await getDocs(q);\n      querySnapshot.forEach(doc => {\n        setUser(doc.data());\n      });\n      console.log(q);\n    } catch (error) {\n      setError(true);\n    }\n  };\n\n  const handleKey = e => {\n    e.code === \"Enter\" && handleSearch();\n  };\n\n  const handleSelect = async () => {\n    const combinedId = currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n\n    try {\n      const res = await getDoc(doc(db, 'chats', combinedId));\n\n      if (!res.exists()) {\n        // create a chat \n        await setDoc(doc(db, 'chats', combinedId), {\n          messages: []\n        }); //create user chat \n\n        await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n          [combinedId + \".userInfo\"]: {\n            uid: user.uid,\n            displayName: user.displayName,\n            photoURL: user.photoURL\n          },\n          [combinedId + \".date\"]: serverTimestamp()\n        });\n        await updateDoc(doc(db, \"userChats\", user.uid), {\n          [combinedId + \".userInfo\"]: {\n            uid: currentUser.uid,\n            displayName: currentUser.displayName,\n            photoURL: currentUser.photoURL\n          },\n          [combinedId + \".date\"]: serverTimestamp()\n        });\n      }\n    } catch (error) {}\n\n    setUser(null);\n    setUserName(\"\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"search\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"searchForm\",\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Find and chat\",\n        onKeyDown: handleKey,\n        onChange: e => setUserName(e.target.value),\n        value: userName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"span\", {\n      children: \"user not found!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 10\n    }, this), user && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"userChat\",\n      onClick: handleSelect,\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: user.photoURL,\n        alt: \"img\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"userChatInfo\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: user.displayName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Hello\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 16\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Search, \"UOzVbIKlf0mYORrUPFggOlPogBU=\");\n\n_c = Search;\nexport default Search;\n\nvar _c;\n\n$RefreshReg$(_c, \"Search\");","map":{"version":3,"sources":["/home/cyberspacex/Downloads/Capstone-project5/src/components/Search.jsx"],"names":["React","useContext","useState","collection","query","where","getDocs","setDoc","updateDoc","serverTimestamp","db","AuthContext","doc","getDoc","Search","userName","setUserName","user","setUser","error","setError","currentUser","handleSearch","q","querySnapshot","forEach","data","console","log","handleKey","e","code","handleSelect","combinedId","uid","res","exists","messages","displayName","photoURL","target","value"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from 'react'\nimport { collection, query, where,getDocs, setDoc, updateDoc, serverTimestamp } from \"firebase/firestore\";\nimport { db } from '../firebase';\nimport { AuthContext } from '../context/AuthContext';\nimport { doc , getDoc} from 'firebase/firestore';\n// import \"../style.scss\"\nconst Search = () => {\n\n  const [userName, setUserName] = useState('')\n  const [user, setUser] = useState(null)\n  const [error, setError] = useState(false)\n\n  const {currentUser} = useContext(AuthContext)\n\nconst handleSearch = async()=> {\nconst q = query(collection(db, 'users') ,where (\"displayName\", \"==\", userName))\n\n\ntry {\n  const querySnapshot = await getDocs(q);\n  querySnapshot.forEach((doc) => {\n    setUser(doc.data())\n  });\n\n  console.log(q)\n} catch (error) {\n  setError(true)\n}\n\n\n}\n\n  const handleKey = e => {\n    e.code === \"Enter\" && handleSearch()\n  }\n\n\n  const handleSelect =  async()=> {\n    const combinedId =  currentUser.uid > user.uid ? currentUser.uid + user.uid : user.uid + currentUser.uid;\n    try {\n\n    \n      const res =  await getDoc(doc(db, 'chats',combinedId))\n      \n      if(!res.exists()){\n        // create a chat \n        await setDoc(doc(db, 'chats',combinedId),{messages: []})\n\n        //create user chat \n await updateDoc(doc(db, \"userChats\" , currentUser.uid), {\n      [combinedId+\".userInfo\"]:{\n        uid:user.uid,\n        displayName: user.displayName,\n        photoURL: user.photoURL\n      },\n      [combinedId+ \".date\"]: serverTimestamp()\n })\n\n await updateDoc(doc(db, \"userChats\" , user.uid), {\n  [combinedId+\".userInfo\"]:{\n    uid:currentUser.uid,\n    displayName: currentUser.displayName,\n    photoURL: currentUser.photoURL\n  },\n  [combinedId+ \".date\"]: serverTimestamp()\n})\n     \n      }\n   \n    } catch (error) {\n      \n    }\n    setUser(null)\n    setUserName(\"\")\n  }\n  return (\n\n    <div className=\"search\">\n      <div className=\"searchForm\">\n        <input type=\"text\" placeholder='Find and chat' onKeyDown={handleKey} onChange={e => setUserName(e.target.value)}  value={userName}/>\n      </div>  \n{error&& <span>user not found!</span>}\n    {  user && <div className=\"userChat\" onClick={handleSelect}>\n        <img src={user.photoURL}alt=\"img\" />\n        <div className=\"userChatInfo\">\n          <span>{user.displayName}</span>\n\n          <p>Hello</p>\n      </div>\n        </div>}\n\n\n\n    </div>\n  )\n}\n\nexport default Search"]},"metadata":{},"sourceType":"module"}